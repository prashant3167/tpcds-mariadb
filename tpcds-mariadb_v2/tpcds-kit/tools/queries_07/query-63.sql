-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '26955','56174','41094','48369','42284','98584',
                          '63976','89425','28927','47205','42597',
                          '73425','11491','23992','72946','10347',
                          '70804','91781','30142','22140','30702',
                          '39759','30939','93681','62395','97626',
                          '58762','28177','16724','81515','23995',
                          '26431','94461','69416','52020','12917',
                          '18425','22374','67701','42967','98236',
                          '30976','38879','40610','30503','12295',
                          '24505','86665','47993','75965','85766',
                          '33300','46679','57215','22544','44271',
                          '32667','63753','75998','29656','36724',
                          '14908','72344','45265','72827','57293',
                          '71202','81647','71744','67930','84416',
                          '98869','70349','11581','98765','57544',
                          '86612','51283','34931','75424','25422',
                          '74920','21580','34627','73080','26011',
                          '57657','74540','66519','50974','42014',
                          '91255','56219','52142','10157','75547',
                          '82094','94203','94030','20437','30062',
                          '90284','41986','72220','34619','45671',
                          '71883','42821','76747','24771','82898',
                          '50175','62312','24642','79977','45792',
                          '46523','29318','42096','85772','28581',
                          '91559','93277','88418','15825','25189',
                          '30061','63339','47270','32386','34998',
                          '93870','10155','43074','54567','60472',
                          '57252','33315','89198','70536','76176',
                          '27338','19643','13036','90826','81577',
                          '27746','61658','42696','79120','49655',
                          '11731','32311','16532','32348','35820',
                          '24036','65369','60891','49643','93646',
                          '54551','63354','57495','77776','46770',
                          '60583','47691','19656','98808','14240',
                          '62996','93048','63295','62913','64123',
                          '13860','82009','15379','46216','46318',
                          '29740','58782','68324','49113','74971',
                          '81810','21032','12005','48079','51887',
                          '36053','10093','48730','43809','53589',
                          '19668','90474','99382','31901','48338',
                          '51504','51832','80608','52358','53147',
                          '69839','77304','30007','59811','61979',
                          '18899','33375','64346','41879','57855',
                          '14931','55549','82573','99169','56312',
                          '88035','11380','54959','29614','16014',
                          '61876','15889','25816','26795','33302',
                          '37153','58707','86294','29286','57437',
                          '43121','16700','61582','61465','10379',
                          '47954','94766','81640','99940','20281',
                          '25499','34172','50600','83074','60180',
                          '45231','92482','54539','17433','23953',
                          '65471','49623','71317','51417','20465',
                          '54001','56134','83847','36942','57876',
                          '12522','26201','74288','11841','96556',
                          '95758','10962','98113','97728','11602',
                          '20380','21293','16970','36364','28560',
                          '75576','15106','91222','17440','73698',
                          '13944','77493','24769','78755','51135',
                          '47795','48499','23701','30111','12125',
                          '12500','10038','20276','52583','32211',
                          '94648','48868','14393','11944','93356',
                          '58033','91546','70148','32786','55193',
                          '27081','47772','55155','19381','80439',
                          '57375','40434','14292','58032','38336',
                          '31090','34726','14079','81530','55637',
                          '88087','92824','27831','88260','14553',
                          '14643','36656','17997','14346','29465',
                          '79573','13104','45756','23270','21578',
                          '38066','79447','65912','32888','24443',
                          '46311','42627','24318','33676','56404',
                          '60676','19686','56755','62172','19923',
                          '70754','25865','65603','92227','95703',
                          '30273','34156','27632','54112','43363',
                          '69941','97928','57193','86069','25855',
                          '92705','45091','65992','40962','71611',
                          '40606','70191','64328','55863','78652',
                          '57347','24709','11338','41961','71464',
                          '55211','74993','37444','47741','53431',
                          '33824','90037','40305','37994','62734',
                          '32366','15923','21953','68922')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;

-- end query 63 in stream 0 using template query8.tpl
